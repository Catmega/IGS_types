---
- name: docker playbook
  hosts: all
  gather_facts: false

  tasks:
    - name: change permission
      command: sudo chmod 666 /var/run/docker.sock

    - name: Initial swarm
      community.docker.docker_swarm:
        state: present

      register: swarm_init_output

    - name: Set join_token attribute (in tosca network type)
      set_stats:
        data:
          join_token: "{{ swarm_init_output.swarm_facts.JoinTokens.Worker }}"

    # - name: Create overlay network
    #   docker_network:
    #     name: "{{ NETWORK_NAME }}"
    #     driver: "{{ NETWORK_DRIVER }}"
    #     attachable: true
    #     scope: "swarm"
    - name: Merge node labels and new labels
      community.docker.docker_node:
        hostname: "{{ HOST_NAME }}"
        labels:
          "{{ NODE_LABELS }}"
   
        


    